<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta http-equiv="Content-Language" content="en" />
<title>DocuMonster — A4 Studio (HTML Paged v0.7.0)</title>
<style>
  /* ====== Base ====== */
  *,*::before,*::after{ box-sizing: border-box; }
  html,body{ margin:0; padding:0; }
  :root{
    --bleed: 3mm;
    --page-w: 210mm; --page-h: 297mm;
    --sheet-w: calc(var(--page-w) + 2*var(--bleed));
    --sheet-h: calc(var(--page-h) + 2*var(--bleed));
    --m-top: 15mm; --m-out: 17mm; --m-bot: 20mm; --m-in: 17mm; /* on-screen */
    --col-gap: 6mm;
    --accent: #008080; /* teal-ish */
    --ink: #111; --ink-soft:#444; --rule:#ddd; --paper:#fff; --thumb-bg:#c0c0c0;
    --font-ui: "Tahoma","Segoe UI","MS Sans Serif",ui-sans-serif,system-ui,sans-serif;
    --font-body: "Times New Roman","Noto Serif",ui-serif,serif;
    --ui-h: 188px; --sidebar-w: 212px;
    --crop-l: 7mm; --crop-w: 0.25mm;
  }

  /* ====== Windows 3.11 look ====== */
  body{ background:#c0c0c0; font: 12px var(--font-body); color: var(--ink); }
  #ui{ position: sticky; top:0; z-index:1000; background:#c0c0c0; padding:6px; border-bottom: 2px solid #808080; display:flex; flex-direction:column; align-items:stretch; gap:6px; }
  .toolbar-row{ display:flex; align-items:center; gap:6px; flex-wrap:wrap; }
  .win-group{ padding:6px; background:#c0c0c0; border:2px solid #808080; border-right-color:#fff; border-bottom-color:#fff; }
  .win-btn{ padding:2px 8px; min-width:28px; background:#c0c0c0; border:2px solid #fff; border-right-color:#000; border-bottom-color:#000; cursor:pointer; font: 12px var(--font-ui); }
  .win-btn:active{ border:2px solid #000; border-right-color:#fff; border-bottom-color:#fff; }
  .win-btn.mini{ padding:1px 6px; min-width:0; font-size:11px; }
  .win-btn.danger{ color:#8b0000; }
  .win-check{ display:inline-flex; align-items:center; gap:4px; font:12px var(--font-ui); }
  .win-check input{ width:13px; height:13px; }
  .win-stat{ font:12px var(--font-ui); padding:2px 6px; background:#fff; border:2px solid #000; border-right-color:#fff; border-bottom-color:#fff; }
  input[type="number"], select{ font:12px var(--font-ui); padding:2px 4px; background:#fff; border:2px solid #000; border-right-color:#fff; border-bottom-color:#fff; }
  textarea{ font:12px var(--font-ui); padding:4px; background:#fff; border:2px solid #000; border-right-color:#fff; border-bottom-color:#fff; resize:vertical; width:100%; min-height:82px; }
  .hidden{ display:none !important; }
  .spacer{ flex:1 1 auto; }

  /* ===== Menu bar ===== */
  .menu-bar{ display:flex; align-items:stretch; gap:6px; }
  .menu{ position:relative; }
  .menu > button{ font:12px var(--font-ui); padding:4px 14px; border:2px solid #fff; border-right-color:#000; border-bottom-color:#000; background:#c0c0c0; cursor:pointer; }
  .menu > button:focus-visible{ outline:2px dotted #000; }
  .menu.open > button{ border:2px solid #000; border-right-color:#fff; border-bottom-color:#fff; background:#8fb5ff; }
  .menu-list{ position:absolute; top:100%; left:0; min-width:160px; background:#c0c0c0; border:2px solid #000; border-right-color:#fff; border-bottom-color:#fff; display:none; flex-direction:column; padding:4px 0; z-index:1200; }
  .menu.open .menu-list{ display:flex; }
  .menu-item{ font:12px var(--font-ui); padding:4px 14px; cursor:pointer; }
  .menu-item:hover{ background:#8fb5ff; }
  .menu-divider{ height:2px; margin:4px 0; background:linear-gradient(to right,#000,#fff); }
  .menu-title{ font:12px var(--font-ui); padding:4px 10px; border:2px solid #fff; border-right-color:#000; border-bottom-color:#000; background:#d3d3d3; }

  /* ===== Sidebar thumbnails ===== */
  #sidebar{ position: fixed; top: var(--ui-h); left:0; bottom:0; width: var(--sidebar-w); background:#c0c0c0; border-right: 2px solid #808080; overflow:auto; padding:6px; }
  #thumbs .thumb{ padding:4px; margin:6px 0; background:#c0c0c0; border:2px solid #808080; border-right-color:#fff; border-bottom-color:#fff; cursor:pointer; }
  #thumbs .thumb.active{ outline:2px solid var(--accent); }
  .mini-wrap{ width: 160px; height: 230px; overflow:hidden; position: relative; margin:4px auto; background:#fff; }
  .mini-wrap .sheet{ box-shadow:none; border:none; }
  .mini-wrap .trim::before, .mini-wrap .crop, .mini-wrap .marks{ display:none; }
  .mini-meta{ text-align:center; font: 11px var(--font-ui); color:#000; }

  /* ===== Pages ===== */
  #pages{ margin-left: calc(var(--sidebar-w) + 10px); }
  .sheet{ position: relative; width: var(--sheet-w); height: var(--sheet-h); background: var(--paper); color: var(--ink); box-shadow: 0 0 0 2px #808080, 0 0 0 4px #fff; margin: 10px auto; border:none; scroll-margin-top: calc(var(--ui-h) + 8px); overflow:hidden; }
  .sheet{ --inPage: var(--m-in); --outPage: var(--m-out); }
  .sheet.even{ --inPage: var(--m-out); --outPage: var(--m-in); }

  /* Crop marks */
  .crop{ position:absolute; width:0; height:0; }
  .crop::before, .crop::after{ content:""; position:absolute; background:#000; }
  .crop.tl{ left: var(--bleed); top: var(--bleed); }
  .crop.tr{ right: var(--bleed); top: var(--bleed); }
  .crop.bl{ left: var(--bleed); bottom: var(--bleed); }
  .crop.br{ right: var(--bleed); bottom: var(--bleed); }
  .crop.tl::after, .crop.tr::after, .crop.bl::after, .crop.br::after{ height: var(--crop-w); width: var(--crop-l); }
  .crop.tl::after{ left: 0; top: calc(var(--m-top) - var(--crop-w)); transform: translateX(calc(-1 * var(--crop-l))); }
  .crop.tr::after{ right: 0; top: calc(var(--m-top) - var(--crop-w)); }
  .crop.bl::after{ left: 0; bottom: calc(var(--m-bot) - var(--crop-w)); transform: translateX(calc(-1 * var(--crop-l))); }
  .crop.br::after{ right: 0; bottom: calc(var(--m-bot) - var(--crop-w)); }
  .crop.tl::before, .crop.tr::before, .crop.bl::before, .crop.br::before{ width: var(--crop-w); height: var(--crop-l); }
  .crop.tl::before{ top: 0; left: calc(var(--inPage) - var(--crop-w)); transform: translateY(calc(-1 * var(--crop-l))); }
  .crop.tr::before{ top: 0; right: calc(var(--outPage) - var(--crop-w)); transform: translateY(calc(-1 * var(--crop-l))); }
  .crop.bl::before{ bottom: 0; left: calc(var(--inPage) - var(--crop-w)); }
  .crop.br::before{ bottom: 0; right: calc(var(--outPage) - var(--crop-w)); }

  /* Trim + content */
  .trim{ position:absolute; left: var(--bleed); top: var(--bleed); width: var(--page-w); height: var(--page-h); }
  .trim::before{ content:""; position:absolute; left: var(--inPage); right: var(--outPage); top: var(--m-top); bottom: var(--m-bot); border:1px dotted #808080; }
  .content{ position:absolute; left: var(--inPage); right: var(--outPage); top: var(--m-top); bottom: var(--m-bot); }

  /* Marks */
  .marks{ position:absolute; inset:0; pointer-events:none; }
  .marks .colorbar{ position:absolute; left: var(--bleed); right: var(--bleed); bottom: 0.8mm; height: 6mm; display:flex; gap:0.6mm; align-items:stretch; }
  .marks .patch{ flex:0 0 10mm; height:100%; border:0.2pt solid #ccc; }
  .patch.c{ background:#00B5E2; } .patch.m{ background:#D5006D; } .patch.y{ background:#FFD400; } .patch.k{ background:#000; }
  .patch.r{ background:#FF3B30; } .patch.g{ background:#34C759; } .patch.b{ background:#007AFF; }
  .patch.w{ background:#fff; } .patch.g10{ background:#1a1a1a; } .patch.g20{ background:#333; } .patch.g30{ background:#4d4d4d; }
  .patch.g40{ background:#666; } .patch.g50{ background:#808080; } .patch.g60{ background:#999; } .patch.g70{ background:#b3b3b3; } .patch.g80{ background:#ccc; } .patch.g90{ background:#e6e6e6; }
  .marks .info{ position:absolute; right: var(--bleed); top: 0.8mm; font: 11px var(--font-ui); color:#000; background:#fff; padding:2px 4px; border:1px solid #808080; }
  .marks .reg{ position:absolute; width:7mm; height:7mm; border-radius:50%; border:1px solid #000; }
  .marks .reg::before, .marks .reg::after{ content:""; position:absolute; left:50%; top:50%; background:#000; transform:translate(-50%,-50%); }
  .marks .reg::before{ width:6mm; height:0.25mm; }
  .marks .reg::after{ width:0.25mm; height:6mm; }
  .marks .reg.tl{ left: 1mm; top: 1mm; } .marks .reg.tr{ right: 1mm; top: 1mm; }
  .marks .reg.bl{ left: 1mm; bottom: 1mm; } .marks .reg.br{ right: 1mm; bottom: 1mm; }
  .marks .safe-area{ position:absolute; left: var(--bleed); right: var(--bleed); top: var(--bleed); bottom: var(--bleed); border:1px dotted #bbb; }
  body.printshop .marks::after{ content:""; position:absolute; inset:0; background:
    repeating-linear-gradient(to bottom, rgba(0,0,0,.06), rgba(0,0,0,.06) 0.4mm, transparent 0.4mm, transparent 1.6mm),
    repeating-linear-gradient(to right, rgba(0,0,0,.04), rgba(0,0,0,.04) 0.4mm, transparent 0.4mm, transparent 1.6mm);
  }
  body.printshop .marks .slur{ position:absolute; width:14mm; height:14mm; border:1px dashed #000; border-radius: 50%; left: calc(50% - 7mm); top: 1mm; }

  /* Content blocks */
  h1,h2,h3{ font-family: var(--font-ui); margin:0 0 3mm 0; line-height:1.2; }
  h1.title{ font-size: 20px; }
  h2{ font-size: 14px; }
  h3{ font-size: 12px; }
  p{ margin:0 0 3.2mm 0; hyphens:auto; orphans:3; widows:3; }
  .head{ padding: 6mm 0 3mm 0; border-bottom:1px solid #ddd; }
  .cols{ padding: 4mm 0 0 0; column-fill:auto; }
  .cols-1{ column-count:1; }
  .cols-2{ column-count:2; column-gap: var(--col-gap); }
  .cols-3{ column-count:3; column-gap: var(--col-gap); }
  .cols p, .cols li, .cols figure, .cols h2, .cols h3{ break-inside: avoid-column; }
  .span-all{ column-span: all; break-before: column; break-after: column; }
  .split{ padding-bottom: 6mm; }
  .foot{ padding: 3mm 0 4mm 0; border-top:1px solid #ddd; font: 11px var(--font-ui); color:#333; display:flex; justify-content:space-between; }
  figure{ margin:0 0 4mm 0; }
  .ph{ width:100%; height:40mm; background: linear-gradient(135deg,#e8f7fb,#f5e8ff); border:1px solid #dcdcdc; }
  figcaption{ font: 11px var(--font-ui); color:#555; margin-top:1.6mm; }
  .content::after{ content:""; display:block; clear:both; }

  /* ===== Editor ===== */
  #editorPanel{ display:grid; grid-template-columns: repeat(auto-fit,minmax(220px,1fr)); gap:8px; align-items:start; }
  #editorPanel header{ grid-column:1/-1; display:flex; justify-content:space-between; align-items:center; font:12px var(--font-ui); }
  #editorStatus{ font-weight:bold; }
  #pageTools{ display:flex; gap:6px; align-items:center; font:12px var(--font-ui); }
  #pageTools span{ display:inline-block; min-width:70px; }
  #editNone{ font-style:italic; font:12px var(--font-ui); grid-column:1/-1; }
  .edit-section{ display:none; flex-direction:column; gap:6px; grid-column: span 1; }
  .edit-section label{ display:flex; flex-direction:column; gap:4px; font:11px var(--font-ui); text-transform:uppercase; letter-spacing:0.04em; }
  .edit-section.active{ display:flex; }
  .edit-section small{ font-size:10px; color:#333; }
  #deleteBlockBtn{ grid-column:1/-1; justify-self:start; }

  /* ===== Editable blocks ===== */
  .editable-block{ position:relative; cursor:pointer; }
  .editable-block::after{ content:""; position:absolute; inset:0; border:2px solid transparent; pointer-events:none; }
  .editable-block.selected::after, .frame.selected{ outline:2px solid var(--accent); box-shadow:0 0 0 2px rgba(255,255,255,0.8) inset; }
  .frame-layer{ position:absolute; inset:0; pointer-events:none; }
  .frame{ position:absolute; background:#fff; border:1px solid #555; padding:3mm; box-shadow: 0 0 0 1px rgba(0,0,0,0.18); font:11px var(--font-ui); color:#222; pointer-events:auto; display:flex; flex-direction:column; gap:2mm; }
  .frame.text-frame p{ margin:0 0 2mm 0; font: 12px var(--font-body); }
  .frame.text-frame p:last-child{ margin-bottom:0; }
  .frame.image-frame{ padding:0; overflow:hidden; }
  .frame.image-frame img{ width:100%; height:100%; object-fit:cover; display:block; }
  .frame .frame-heading{ font-weight:bold; font-size:12px; letter-spacing:0.05em; text-transform:uppercase; }
  .frame-wrap{ font:10px var(--font-ui); color:#555; }
  .wrap-layer{ pointer-events:none; }
  .wrap-layer .wrap-box{ opacity:0.05; }
  .wrap-layer .wrap-box.wrap-left{ float:left; }
  .wrap-layer .wrap-box.wrap-right{ float:right; }
  .wrap-layer .wrap-box.push{ width:100%; clear:both; }

  /* Toggles */
  body.hide-guides .trim::before{ display:none !important; }
  body.no-crop .crop{ display:none !important; }
  body.hide-crops .crop{ display:none !important; }
  body.hide-colorbar .marks .colorbar{ display:none !important; }
  body.hide-reg .marks .reg{ display:none !important; }
  body.hide-safe .marks .safe-area{ opacity:0 !important; }

  /* ====== PRINT: absolute page box + symmetric margins ====== */
  @media print{
    @page{ size: 216mm 303mm; margin:0; }
    html,body{ width:216mm; height:303mm; margin:0; padding:0; }
    #ui,#sidebar{ display:none!important; }
    #pages{ margin:0; }
    /* Neutralize UA centering: anchor at 0,0 */
    body, #pages{ position: static !important; }
    .sheet{ position: relative !important; left:0!important; top:0!important; width:216mm!important; height:303mm!important; margin:0!important; box-shadow:none!important; border:none!important; page-break-after: always; page-break-inside: avoid; overflow:hidden; }
    .sheet:last-child{ page-break-after:auto; }
    .trim{ left:3mm!important; top:3mm!important; width:210mm!important; height:297mm!important; }
    /* Symmetric margins in print to avoid apparent left/bottom bias */
    :root{ --m-top: 12mm; --m-bot: 12mm; --m-in: 12mm; --m-out: 12mm; }
    /* Optional mirrored gutter when class present */
    body.pdf-mirror .sheet.even{ --m-in: 20mm; --m-out: 14mm; }
    /* Ensure exact colors */
    *{ -webkit-print-color-adjust: exact; print-color-adjust: exact; }
  }
</style>
</head>
<body>

  <!-- ======= Windows 3.11 Toolbar ======= -->
  <div id="ui" style="height:var(--ui-h)">
    <div class="menu-bar">
      <div class="menu" data-menu="file">
        <button type="button">File</button>
        <div class="menu-list">
          <div class="menu-item" data-action="newDoc">New…</div>
          <div class="menu-item" data-action="openDoc">Open…</div>
          <div class="menu-item" data-action="saveDoc">Save</div>
          <div class="menu-item" data-action="saveAsDoc">Save As…</div>
          <div class="menu-divider"></div>
          <div class="menu-item" data-action="exportJSON">Export JSON Snapshot</div>
        </div>
      </div>
      <div class="menu" data-menu="output">
        <button type="button">Output</button>
        <div class="menu-list">
          <div class="menu-item" data-action="pdfBleed">PDF — Press Ready (Bleed)</div>
          <div class="menu-item" data-action="pdfTrim">PDF — Trimmed Proof</div>
          <div class="menu-divider"></div>
          <div class="menu-item" data-action="toggleMirror">Toggle Mirrored Gutter</div>
        </div>
      </div>
      <div class="menu" data-menu="edit">
        <button type="button">Edit</button>
        <div class="menu-list">
          <div class="menu-item" data-action="addColumns1">Insert 1-Column Flow</div>
          <div class="menu-item" data-action="addColumns2">Insert 2-Column Flow</div>
          <div class="menu-item" data-action="addColumns3">Insert 3-Column Flow</div>
          <div class="menu-divider"></div>
          <div class="menu-item" data-action="addTextFrame">Insert Text Frame</div>
          <div class="menu-item" data-action="addImageFrame">Insert Image Frame</div>
          <div class="menu-divider"></div>
          <div class="menu-item" data-action="addPageAfter">Add Blank Page</div>
          <div class="menu-item" data-action="duplicatePage">Duplicate Current Page</div>
        </div>
      </div>
      <div class="menu-title" id="releaseLabel">DocuMonster Workbench 3.11R</div>
    </div>

    <div class="toolbar-row">
      <div class="win-group">
        <button class="win-btn" id="firstBtn">|◀</button>
        <button class="win-btn" id="prevBtn">◀</button>
        <span class="win-stat">Page <span id="cur">1</span> / <span id="tot">1</span></span>
        <input type="number" id="goto" min="1" max="1" value="1" />
        <button class="win-btn" id="goBtn">Go</button>
        <button class="win-btn" id="nextBtn">▶</button>
        <button class="win-btn" id="lastBtn">▶|</button>
      </div>
      <div class="win-group">
        <label class="win-check"><input type="checkbox" id="chkGuides" checked> Guides</label>
        <label class="win-check"><input type="checkbox" id="chkCrops" checked> Marks</label>
        <label class="win-check"><input type="checkbox" id="chkColor" checked> Color bars</label>
        <label class="win-check"><input type="checkbox" id="chkReg" checked> Registration</label>
        <label class="win-check"><input type="checkbox" id="chkSafe"> Safe</label>
        <label class="win-check"><input type="checkbox" id="chkShop"> Printshop grid</label>
        <label class="win-check"><input type="checkbox" id="chkMirror"> Mirrored gutter (PDF)</label>
        <label class="win-check">Preset:<select id="selColorPreset"><option value="std">Standard</option><option value="ugra">Ugra/Fogra 21</option></select></label>
      </div>
      <div class="spacer"></div>
      <div class="win-group">
        <button class="win-btn" id="pdfBtn">PDF: bleed</button>
        <button class="win-btn" id="pdfTrimBtn">PDF: A4</button>
        <span class="win-stat" id="ver">DocuMonster OS • v0.9.9</span>
      </div>
    </div>

    <div id="editorPanel" class="win-group">
      <header>
        <span>Editor</span>
        <span id="editorStatus">Saved</span>
      </header>
      <div id="pageTools">
        <span>Active page: <strong id="pageLabel">1 / 1</strong></span>
        <button class="win-btn mini" id="addPageBtn">Add Page</button>
        <button class="win-btn mini" id="duplicatePageBtn">Duplicate Page</button>
      </div>
      <div id="editNone">Select a flow or frame to edit.</div>
      <div id="editColumns" class="edit-section">
        <label>Column count<input type="number" id="colCount" min="1" max="6" value="2"></label>
        <label>Column gap<input type="text" id="colGap" value="6mm"></label>
        <label>Content<textarea id="colContent"></textarea><small>Separate paragraphs with blank lines. Use ## for headings and ### for subheads.</small></label>
        <button class="win-btn mini" id="applyColumnContent">Apply Text</button>
      </div>
      <div id="editFrame" class="edit-section">
        <label>Frame type<select id="frameType"><option value="text">Text</option><option value="image">Image</option></select></label>
        <label>Position X<input type="text" id="frameX" value="30mm"></label>
        <label>Position Y<input type="text" id="frameY" value="40mm"></label>
        <label>Width<input type="text" id="frameW" value="60mm"></label>
        <label>Height<input type="text" id="frameH" value="40mm"></label>
        <label>Heading<input type="text" id="frameHeading" placeholder="Deck / caption"></label>
        <label>Wrap mode<select id="frameWrap"><option value="overlay">Overlay</option><option value="push">Push Down</option><option value="wrap-left">Wrap Left</option><option value="wrap-right">Wrap Right</option></select></label>
        <label id="frameTextWrapper">Frame content<textarea id="frameContent"></textarea></label>
        <label id="frameImageWrapper" class="hidden">Image source<input type="text" id="frameSrc" placeholder="https://"></label>
        <button class="win-btn mini" id="applyFrameContent">Apply Frame</button>
      </div>
      <button class="win-btn danger" id="deleteBlockBtn" disabled>Delete Selected Block</button>
    </div>
    <input type="file" id="fileLoader" accept=".dmon,.json" class="hidden" />
  </div>

  <aside id="sidebar"><div id="thumbs"></div></aside>
  <div id="pages"></div>

<script src="app-js/documonster-page.js"></script>
</body>
</html>
