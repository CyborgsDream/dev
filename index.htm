<!-- ...existing code... -->
<!--
  index.htm — Redirect shim (version 0.9.0)
  Purpose: robust front-end redirect that attempts multiple client-side strategies
  in a safe, SEO-friendly and CSP-aware order. This file:
    - Declares canonical target (index.html) and optional noindex.
    - Provides meta-refresh and <noscript> fallbacks for non-JS clients.
    - Attempts top-frame breakout when embedded in an iframe.
    - Registers a service worker (optional) and waits briefly so the SW can intercept navigations.
    - Uses location.replace by default (no history entry).
    - Falls back to assign/href if replace isn't available.
    - Exposes a data-target attribute for easy customization without editing the script.
  Notes / Recommendations:
    - Prefer server-side 301/302 redirects (IIS/nginx/hosting control panel) for SEO and crawlers.
    - If you use a strict CSP that blocks inline scripts, move the JS below into an external file
      and update your CSP to allow it (or add a nonce).
    - Optionally create a service worker file sw-redirect.js (example snippet provided in comments).
-->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">

  <!-- Canonical target for this shim; change href or set data-target on <html> to override. -->
  <link rel="canonical" href="index.html">

  <!--
    Quick non-JS fallback. Meta-refresh is simple but suboptimal for SEO;
    keep it as a last-resort client-side fallback.
  -->
  <meta http-equiv="refresh" content="0; url=index.html">

  <!-- Prevent indexing of this shim itself (uncomment if desired) -->
  <!-- <meta name="robots" content="noindex"> -->

  <title>Redirecting…</title>

  <style>
    /* Minimal, unobtrusive styles for the visible fallback UI */
    :root { color-scheme: light dark; }
    html,body { height:100%; margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial; display:flex; align-items:center; justify-content:center; background:#fff; color:#111; }
    .redirect { max-width:36rem; padding:1.25rem; text-align:center; }
    .muted { color: #6b7280; font-size:0.95rem; }
    a.button { display:inline-block; margin-top:.75rem; padding:.5rem .9rem; background:#0b5fff; color:#fff; text-decoration:none; border-radius:.375rem; }
    @media (prefers-color-scheme: dark) {
      body { background:#0b1220; color:#e6eef8; }
      a.button { background:#5aa0ff; color:#00142a; }
    }
  </style>
</head>
<body data-target="index.html">
  <main class="redirect" role="main" aria-live="polite">
    <h1>Redirecting…</h1>
    <p class="muted">If the browser does not redirect automatically, use the link below.</p>
    <p><a class="button" id="manual-link" href="index.html">Go to index.html</a></p>
    <p class="muted" style="font-size:.85rem;margin-top:.5rem;">
      This page attempts several client-side redirect strategies (service worker, JS replace,
      meta-refresh, iframe-breakout) to provide the best UX and compatibility.
    </p>
  </main>

  <noscript>
    <!-- For no-JS clients, meta-refresh above will run. Also offer a visible link. -->
    <style> .noscript-only { display:block; text-align:center; padding:1rem; } </style>
    <div class="noscript-only">
      <p>You appear to have JavaScript disabled. Click <a href="index.html">here</a> to continue.</p>
    </div>
  </noscript>

  <script>
    (function () {
      'use strict';

      // Configurable target: prefer <link rel="canonical">, then body data-target, then fallback.
      var canonical = (document.querySelector && document.querySelector('link[rel="canonical"]')) ?
        document.querySelector('link[rel="canonical"]').getAttribute('href') : null;
      var target = canonical || document.body.getAttribute('data-target') || 'index.html';

      // Timeouts: how long to wait for optional systems (service worker) before falling back.
      var SW_WAIT_MS = 600;    // wait for service worker to register/activate (short to avoid spinner)
      var TOTAL_WAIT_MS = 1400; // overall max before forcing redirect

      // Helper redirects (prefer replace to avoid a history entry)
      function replaceLocation(url) {
        try {
          if (window.location.replace) {
            window.location.replace(url);
            return true;
          }
        } catch (e) { /* ignore */ }
        return false;
      }
      function assignLocation(url) {
        try {
          if (window.location.assign) {
            window.location.assign(url);
            return true;
          }
        } catch (e) { /* ignore */ }
        return false;
      }
      function hrefLocation(url) {
        try {
          window.location.href = url;
          return true;
        } catch (e) { /* ignore */ }
        return false;
      }

      // Attempt top-frame breakout if embedded inside an iframe and same-origin allows it.
      function attemptTopBreakout(url) {
        try {
          if (window.top && window.top !== window.self) {
            // Using replace to avoid adding the shim to parent history.
            window.top.location.replace(url);
            return true;
          }
        } catch (e) {
          // cross-origin parent prevents breakout — ignore and continue fallback
        }
        return false;
      }

      // Attempt a SPA-style soft redirect using history API if the app supports it.
      function attemptHistoryReplace(url) {
        try {
          if (history && history.replaceState) {
            // Replace the current entry's URL — no reload. Useful if a client router will handle the new URL.
            history.replaceState({}, '', url);
            // If you want to let a client router render immediately, you could dispatch an event:
            // window.dispatchEvent(new CustomEvent('shim:redirect', { detail: { url: url } }));
            return true;
          }
        } catch (e) { /* ignore */ }
        return false;
      }

      // Service worker: register an optional redirect-capable SW to intercept navigations.
      // This gives you the opportunity to serve offline or control redirect semantics.
      // Create sw-redirect.js in your server root with the sample provided in comments below.
      function tryServiceWorkerThenRedirect(url, onFallback) {
        if (!('serviceWorker' in navigator)) {
          onFallback();
          return;
        }

        var didRespond = false;
        var timer = setTimeout(function () { if (!didRespond) onFallback(); }, SW_WAIT_MS);

        navigator.serviceWorker.register('/sw-redirect.js').then(function (reg) {
          // Give the SW some time to activate and take control; wait for ready or for the controller.
          return navigator.serviceWorker.ready;
        }).then(function () {
          // If the page is already controlled, give the SW a tiny window to react to the navigation.
          // Using replace allows SW to intercept navigation requests in many setups.
          didRespond = true;
          clearTimeout(timer);
          replaceLocation(url) || assignLocation(url) || hrefLocation(url);
        }).catch(function () {
          // Registration failed or timed out — fallback to JS redirect.
          didRespond = true;
          clearTimeout(timer);
          onFallback();
        });
      }

      // Main redirect orchestration with multiple fallbacks and a maximum timeout to avoid trapping user.
      (function orchestrate() {
        var start = Date.now();

        // If inside iframe, try to escape immediately.
        if (attemptTopBreakout(target)) return;

        // If an SPA router exists and prefers soft navigation, attempt history replace first.
        // This will not reload the page. It is opt-in: if your SPA listens to the URL change,
        // it can render the new route. If not, we'll force a full navigation below.
        var didHistory = attemptHistoryReplace(target);
        if (didHistory) {
          // Give client code a short chance to respond, then hard-redirect if nothing happens.
          setTimeout(function () {
            if (Date.now() - start < TOTAL_WAIT_MS) {
              // If app hasn't intercepted navigation within the timeout, do a full replace.
              replaceLocation(target) || assignLocation(target) || hrefLocation(target);
            }
          }, 300);
          return;
        }

        // Try registering a service worker and let it handle navigations (if provided).
        tryServiceWorkerThenRedirect(target, function () {
          // Fallback to immediate JS redirect (preferred: replace to avoid polluting history).
          replaceLocation(target) || assignLocation(target) || hrefLocation(target);
        });

        // Ensure we won't wait forever: final fallback after TOTAL_WAIT_MS
        setTimeout(function () {
          replaceLocation(target) || assignLocation(target) || hrefLocation(target);
        }, TOTAL_WAIT_MS);
      }());

      // Enhance manual link to point to computed target (useful if canonical/data-target changed).
      (function updateManualLink() {
        try {
          var link = document.getElementById('manual-link');
          if (link) { link.setAttribute('href', target); }
        } catch (e) { /* ignore */ }
      }());

    }());
  </script>

  <!--
    OPTIONAL: Example service worker (save as /sw-redirect.js at your site root)
    ------------------------------------------------------------
    // This file is NOT embedded here; create it on the server if you want SW-based redirects.
    self.addEventListener('install', event => { self.skipWaiting(); });
    self.addEventListener('activate', event => { event.waitUntil(self.clients.claim()); });
    self.addEventListener('fetch', event => {
      // Intercept top-level navigation and redirect to /index.html if desired.
      if (event.request.mode === 'navigate') {
        // Example: always serve index.html (useful for SPA setups)
        event.respondWith(fetch('/index.html', { cache: 'no-store' }).catch(() => caches.match('/offline.html')));
      }
    });
    ------------------------------------------------------------
    Put an appropriate CORS and caching policy in place for your SW and test thoroughly.
  -->

</body>
</html>
<!-- ...existing code... -->