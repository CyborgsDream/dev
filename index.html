<!doctype html>
<html lang="en" data-target="index.html">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="canonical" href="index.html">
  <title>DEMOS</title>
  <link id="theme-link" rel="stylesheet" href="css/style.css">
  <style>
    :root { color-scheme: light dark; }
    #redirect-fallback { max-width:36rem; padding:1.25rem; text-align:center; margin: 0 auto; }
    #redirect-fallback .muted { color: #6b7280; font-size:0.95rem; }
    #redirect-fallback a.button { display:inline-block; margin-top:.75rem; padding:.5rem .9rem; background:#0b5fff; color:#fff; text-decoration:none; border-radius:.375rem; }
    body.redirect-active { display: flex; align-items: center; justify-content: center; background:#fff; color:#111; }
    @media (prefers-color-scheme: dark) {
      body.redirect-active { background:#0b1220; color:#e6eef8; }
      body.redirect-active #redirect-fallback a.button { background:#5aa0ff; color:#00142a; }
    }
  </style>
</head>
<body class="redirect-active">
  <main id="app-shell" hidden>
    <div id="scene-container" aria-live="polite">
      <div id="fps-counter" aria-label="frames per second">Loading…</div>
      <div id="version-number">v1.9.1</div>

      <div id="demo-files" aria-labelledby="demo-heading">
        <h2 id="demo-heading">Demo files</h2>
        <ul id="demo-list"></ul>
      </div>

      <div id="console-log" role="log" aria-live="polite"></div>

      <div id="cinematic-heading">DEMOS</div>
      <div id="bottom-text">Select a demo object to launch</div>

      <div id="app-info" role="dialog" aria-modal="true" aria-labelledby="app-info-title">
        <span class="close-icon" id="close-info" aria-label="Close dialog">×</span>
        <h2 id="app-info-title">Demo</h2>
        <p>Loading…</p>
        <button id="run-app" type="button">Run</button>
      </div>
    </div>
  </main>

  <div id="theme-selection" aria-label="Select a theme">
    <h2>Choose a theme</h2>
    <div>
      <button type="button" data-theme="dark">Dark</button>
      <button type="button" data-theme="light">Light</button>
      <button type="button" data-theme="futuristic">Futuristic</button>
    </div>
  </div>

  <div id="touch-controls" aria-hidden="true" style="display: none;">
    <button id="move-forward" type="button">▲</button>
    <div>
      <button id="move-left" type="button">◀</button>
      <button id="move-right" type="button">▶</button>
    </div>
    <button id="move-back" type="button">▼</button>
    <div>
      <button id="zoom-in" type="button">＋</button>
      <button id="zoom-out" type="button">－</button>
    </div>
  </div>

  <section id="redirect-fallback" aria-live="polite">
    <h1>Redirecting…</h1>
    <p class="muted">If the browser does not redirect automatically, use the link below.</p>
    <p><a class="button" id="manual-link" href="index.html">Go to index.html</a></p>
    <p class="muted" style="font-size:.85rem;margin-top:.5rem;">
      This page attempts several client-side redirect strategies (service worker, JS replace,
      meta-refresh, iframe-breakout) to provide the best UX and compatibility.
    </p>
  </section>

  <noscript>
    <style> .noscript-only { display:block; text-align:center; padding:1rem; } </style>
    <div class="noscript-only">
      <p>You appear to have JavaScript disabled. Click <a href="index.html">here</a> to continue.</p>
    </div>
  </noscript>

  <script>
    (function () {
      'use strict';

      var canonicalLink = (document.querySelector && document.querySelector('link[rel="canonical"]'))
        ? document.querySelector('link[rel="canonical"]').getAttribute('href')
        : null;
      var target = canonicalLink || document.documentElement.getAttribute('data-target') || 'index.html';
      var targetPath = new URL(target, window.location.href).pathname;
      var isCanonical = window.location.pathname === targetPath || window.location.pathname.endsWith(targetPath);

      var fallback = document.getElementById('redirect-fallback');
      var appShell = document.getElementById('app-shell');
      var body = document.body;
      var manualLink = document.getElementById('manual-link');

      if (manualLink) {
        try { manualLink.setAttribute('href', target); } catch (e) { /* ignore */ }
      }

      function showApp() {
        if (fallback) fallback.style.display = 'none';
        if (appShell) appShell.hidden = false;
        if (body && body.classList.contains('redirect-active')) {
          body.classList.remove('redirect-active');
        }
      }

      function replaceLocation(url) {
        try {
          if (window.location.replace) {
            window.location.replace(url);
            return true;
          }
        } catch (e) { /* ignore */ }
        return false;
      }
      function assignLocation(url) {
        try {
          if (window.location.assign) {
            window.location.assign(url);
            return true;
          }
        } catch (e) { /* ignore */ }
        return false;
      }
      function hrefLocation(url) {
        try {
          window.location.href = url;
          return true;
        } catch (e) { /* ignore */ }
        return false;
      }

      function attemptTopBreakout(url) {
        try {
          if (window.top && window.top !== window.self) {
            window.top.location.replace(url);
            return true;
          }
        } catch (e) { /* ignore */ }
        return false;
      }

      if (isCanonical) {
        showApp();
        return;
      }

      if (attemptTopBreakout(target)) return;

      var SW_WAIT_MS = 600;
      var TOTAL_WAIT_MS = 1400;
      var didRespond = false;

      function finishRedirect() {
        replaceLocation(target) || assignLocation(target) || hrefLocation(target);
      }

      function tryServiceWorkerThenRedirect() {
        if (!('serviceWorker' in navigator)) {
          finishRedirect();
          return;
        }

        var timer = setTimeout(function () { if (!didRespond) finishRedirect(); }, SW_WAIT_MS);

        navigator.serviceWorker.register('/sw-redirect.js').then(function () {
          return navigator.serviceWorker.ready;
        }).then(function () {
          didRespond = true;
          clearTimeout(timer);
          finishRedirect();
        }).catch(function () {
          didRespond = true;
          clearTimeout(timer);
          finishRedirect();
        });
      }

      tryServiceWorkerThenRedirect();

      setTimeout(function () {
        if (!isCanonical) {
          finishRedirect();
        }
      }, TOTAL_WAIT_MS);
    }());
  </script>

  <script type="module" src="js/script.js"></script>
</body>
</html>
